<!DOCTYPE html>
<html lang="ckb" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <img src="/logo.png" alt="نامەکان لۆگۆ" class="logo">
            <nav class="nav">
                <a href="/" class="nav-link">سەرەتا</a>
                <a href="/submit" class="nav-link active">نامە بنێرە</a>
                <a href="/about" class="nav-link">دەربارە</a>
            </nav>
        </header>

        <main class="main-content">
            <!-- Message Form Section -->
            <div class="message-section">
                <h3 class="message-title">نامەکەت بنێرە</h3>
                
                <div class="message-composer">
                    <!-- Message Preview -->
                    <div class="message-preview-container">
                        <div class="message-preview-card" id="messagePreview">
                            <div class="preview-receiver">بۆ: <span id="receiverPreview">ناوی وەرگر</span></div>
                            <div class="preview-content">
                                <div id="contentPreview">نامەکەت لێرە بنووسە...</div>
                            </div>
                            <div class="preview-meta">
                                <span class="preview-date" id="previewDate">ئەمرۆ</span>
                                <span>نامەکان</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Color Palette -->
                    <div class="color-palette">
                        <h4 class="palette-title">رەنگ هەڵبژاردن</h4>
                        <div class="color-grid" id="colorGrid">
                            <div class="color-swatch" data-color="#ffffff" style="background-color: #ffffff;"></div>
                            <div class="color-swatch" data-color="#faf8f5" style="background-color: #faf8f5;"></div>
                            <div class="color-swatch" data-color="#fef7f0" style="background-color: #fef7f0;"></div>
                            <div class="color-swatch" data-color="#f5f0f8" style="background-color: #f5f0f8;"></div>
                            <div class="color-swatch" data-color="#f0f8f5" style="background-color: #f0f8f5;"></div>
                            <div class="color-swatch" data-color="#fff8f0" style="background-color: #fff8f0;"></div>
                            <div class="color-swatch" data-color="#faf0f5" style="background-color: #faf0f5;"></div>
                            <div class="color-swatch" data-color="#fff3cd" style="background-color: #fff3cd;"></div>
                            <div class="color-swatch" data-color="#f0f8e8" style="background-color: #f0f8e8;"></div>
                            <div class="color-swatch" data-color="#e8f4fd" style="background-color: #e8f4fd;"></div>
                            <div class="color-swatch" data-color="#f3e5f5" style="background-color: #f3e5f5;"></div>
                            <div class="color-swatch" data-color="#e9ecef" style="background-color: #e9ecef;"></div>
                        </div>
                    </div>
                    
                    <!-- Input Fields -->
                    <div class="input-fields">
                        <div class="input-group">
                            <label for="receiverName" class="input-label">ناوی وەرگر</label>
                            <input type="text" id="receiverName" name="receiverName" class="input-field" placeholder="ناوی وەرگر بنووسە" required>
                        </div>
                        
                        <div class="input-group">
                            <label for="content" class="input-label">ناوەرۆکی نامە</label>
                            <textarea id="content" name="content" class="input-textarea" placeholder="نامەکەت لێرە بنووسە" required></textarea>
                        </div>
                    </div>
                </div>
                
                <form id="messageForm" style="display: none;">
                    <input type="hidden" id="backgroundColor" name="backgroundColor" value="#faf8f5">
                </form>
                
                <button type="button" id="submitMessage" class="submit-message-btn">نامەکەت بنێرە</button>
                
                <div id="messageStatus" class="message-status"></div>
            </div>
        </main>
    </div>

    <footer class="footer">
        <div class="footer-divider"></div>
        <div class="footer-logo">
            <img src="/logo.png" alt="نامەکان لۆگۆ" class="footer-logo-img">
        </div>
        <div class="footer-link">
            <a href="https://lawenhunar.github.io/portfolio/" target="_blank" class="portfolio-link">لاوێن هونەر</a>
        </div>
    </footer>

    <script>
        // Function to convert English numbers to Kurdish/Arabic numbers
        function toArabicNumerals(str) {
            const arabicNumerals = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
            return str.replace(/\d/g, (digit) => arabicNumerals[parseInt(digit)]);
        }

        // Function to format date with Kurdish/Arabic numerals in day/month/year format
        function formatDate(dateString) {
            const date = new Date(dateString);
            const day = date.getDate();
            const month = date.getMonth() + 1;
            const year = date.getFullYear();
            
            // Format: day/month/year (e.g., "٢٢/٥/٢٠٢٥")
            const formattedDate = `${day}/${month}/${year}`;
            return toArabicNumerals(formattedDate);
        }

        // Color selection functionality
        const colorSwatches = document.querySelectorAll('.color-swatch');
        const backgroundColorInput = document.getElementById('backgroundColor');
        const messagePreview = document.getElementById('messagePreview');
        
        // Initialize with second color (faf8f5) selected as default
        colorSwatches[1].classList.add('selected');
        messagePreview.style.backgroundColor = '#faf8f5';
        
        colorSwatches.forEach(swatch => {
            swatch.addEventListener('click', function() {
                // Remove selected class from all swatches
                colorSwatches.forEach(s => s.classList.remove('selected'));
                
                // Add selected class to clicked swatch
                this.classList.add('selected');
                
                // Update background color
                const selectedColor = this.dataset.color;
                backgroundColorInput.value = selectedColor;
                messagePreview.style.backgroundColor = selectedColor;
            });
        });

        // Update preview date to today
        const previewDate = document.getElementById('previewDate');
        previewDate.textContent = formatDate(new Date().toISOString());

        // Live preview updates
        const receiverNameInput = document.getElementById('receiverName');
        const contentInput = document.getElementById('content');
        const receiverPreview = document.getElementById('receiverPreview');
        const contentPreview = document.getElementById('contentPreview');

        receiverNameInput.addEventListener('input', function() {
            const value = this.value.trim();
            receiverPreview.textContent = value || 'ناوی وەرگر';
        });

        contentInput.addEventListener('input', function() {
            const value = this.value.trim();
            contentPreview.textContent = value || 'نامەکەت لێرە بنووسە...';
        });

        // Submit message functionality
        document.getElementById('submitMessage').addEventListener('click', async function() {
            const receiverName = document.getElementById('receiverName').value.trim();
            const content = document.getElementById('content').value.trim();
            const backgroundColor = backgroundColorInput.value;
            
            const statusDiv = document.getElementById('messageStatus');
            const submitBtn = this;
            
            // Validate input
            if (!receiverName || !content) {
                statusDiv.innerHTML = '<div class="error-message">❌ ناوی وەرگر و ناوەرۆکی نامە پێویستە</div>';
                return;
            }
            
            // Show loading state
            submitBtn.textContent = 'دەنێردرێت...';
            submitBtn.disabled = true;
            statusDiv.innerHTML = '';
            
            try {
                const response = await fetch('/api/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        receiverName: receiverName,
                        content: content,
                        backgroundColor: backgroundColor
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    statusDiv.innerHTML = '<div class="success-message">✅ ' + result.message + '</div>';
                    
                    // Clear the form
                    document.getElementById('receiverName').value = '';
                    document.getElementById('content').value = '';
                    
                    // Reset preview
                    receiverPreview.textContent = 'ناوی وەرگر';
                    contentPreview.textContent = 'نامەکەت لێرە بنووسە...';
                    
                    // Reset to default color
                    colorSwatches.forEach(s => s.classList.remove('selected'));
                    colorSwatches[1].classList.add('selected');
                    backgroundColorInput.value = '#faf8f5';
                    messagePreview.style.backgroundColor = '#faf8f5';
                    
                } else {
                    statusDiv.innerHTML = '<div class="error-message">❌ ' + result.message + '</div>';
                }
                
            } catch (error) {
                statusDiv.innerHTML = '<div class="error-message">❌ هەڵەیەک روویدا لە ناردنی نامەدا</div>';
            } finally {
                // Reset button state
                submitBtn.textContent = 'نامەکەت بنێرە';
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>

